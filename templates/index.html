{% extends "base.html" %}

{% block title %}äºˆç´„ã‚·ã‚¹ãƒ†ãƒ  - æµ·åº•äºŒä¸‡ãƒã‚¤ãƒ«{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
<style>
/* ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.floating-navigation {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    padding: 15px 20px;
    box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
    border-top: 1px solid #e0e0e0;
    z-index: 1000;
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 100%;
    margin: 0 auto;
}

.floating-navigation .btn {
    flex: 1;
    margin: 0 5px;
    padding: 15px 20px;
    font-size: 1.1rem;
    font-weight: bold;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
}

.floating-navigation .btn:first-child {
    background: #6c757d;
    color: white;
    flex: 1;
}

.floating-navigation .btn:last-child {
    background: #008793;
    color: white;
    flex: 1;
}

.floating-navigation .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.floating-navigation .btn:disabled {
    background: #cccccc !important;
    color: #666666 !important;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

/* é€šå¸¸ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤º */
#step1 .navigation,
#step2 .navigation,
#step3 .navigation {
    display: none;
}

/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ä¸‹éƒ¨ä½™ç™½ã‚’è¿½åŠ ã—ã¦ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒœã‚¿ãƒ³ã¨é‡ãªã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹ */
.step {
    padding-bottom: 100px;
}

@media (max-width: 768px) {
    .floating-navigation {
        padding: 12px 15px;
    }
    
    .floating-navigation .btn {
        padding: 12px 15px;
        font-size: 1rem;
    }
}
</style>
{% endblock %}

{% block content %}
<!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ breadcrumb -->
<div style="text-align: center; margin: 20px 0; color: #666;">
    <a href="{{ url_for('index') }}" style="color: #008793; text-decoration: none;">ãƒ›ãƒ¼ãƒ </a> 
    â†’ äºˆç´„
</div>

<h1>æµ·åº•äºŒä¸‡ãƒã‚¤ãƒ« æ•´ç†åˆ¸äºˆç´„ã‚·ã‚¹ãƒ†ãƒ </h1>

{% if active_reservation %}
<!-- æ—¢å­˜ã®äºˆç´„ãŒã‚ã‚‹å ´åˆã®è¡¨ç¤º -->
<div class="ticket">
    <h2>ã‚ãªãŸã®æ•´ç†åˆ¸</h2>
    <div class="qr-code">
        <img src="{{ active_reservation.qr_code_image }}" alt="QRã‚³ãƒ¼ãƒ‰">
    </div>
    <div class="ticket-info">
        <p><strong>äºˆç´„æ™‚é–“:</strong> {{ active_reservation.time }}</p>
        <p><strong>äººæ•°:</strong> {{ active_reservation.guests }}å</p>
        <p><strong>äºˆç´„æ—¥:</strong> {{ active_reservation.date }}</p>
    </div>
    <p>ã“ã®ç”»é¢ã‚’ã‚¹ã‚¿ãƒƒãƒ•ã«ãŠè¦‹ã›ãã ã•ã„</p>
    <div class="mt-20" style="text-align: center;">
        <a href="{{ url_for('index') }}" class="btn" style="background: #008793; color: white; margin: 5px;">
            ãƒ›ãƒ¼ãƒ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
        </a>
        
        <button onclick="cancelReservation()" class="btn btn-danger" style="margin: 5px;">
            äºˆç´„ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        </button>
    </div>
</div>

{% else %}
<!-- æ–°è¦äºˆç´„ãƒ•ã‚©ãƒ¼ãƒ  -->
<div class="progress-bar">
   
    <div class="progress-step active" id="progress-1">1</div>
    <div class="progress-step" id="progress-2">2</div>
    <div class="progress-step" id="progress-3">3</div>
</div>

<!-- é€²æ—èª¬æ˜ -->
<div style="text-align: center; margin: 15px 0; color: #666; font-size: 0.9rem;">
   
    <span style="color: #666666;">1. äººæ•°é¸æŠ</span> â†’ 
    2. æ™‚é–“é¸æŠ â†’ 
    3. ç¢ºèªãƒ»äºˆç´„
</div>

<!-- ã‚¹ãƒ†ãƒƒãƒ—1: äººæ•°é¸æŠ -->
<div id="step1" class="step active">
    {% if today_date %}
    <div style="text-align: center; margin-bottom: 20px;">
        <span style="background: #e3f2fd; color: #1976d2; padding: 10px 20px; border-radius: 20px; font-weight: bold; border: 2px solid #bbdefb;">
            æœ¬æ—¥: {{ today_date }} ã®äºˆç´„
        </span>
    </div>
    {% endif %}
    <h2>äººæ•°ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
    <div class="guests-grid" id="guests-grid-step1">
        <!-- 1-10åã®é¸æŠè‚¢ã‚’è¡¨ç¤º -->
        <div class="guest-btn" data-guests="1" onclick="selectGuests(1)">1å</div>
        <div class="guest-btn" data-guests="2" onclick="selectGuests(2)">2å</div>
        <div class="guest-btn" data-guests="3" onclick="selectGuests(3)">3å</div>
        <div class="guest-btn" data-guests="4" onclick="selectGuests(4)">4å</div>
        <div class="guest-btn" data-guests="5" onclick="selectGuests(5)">5å</div>
        <div class="guest-btn" data-guests="6" onclick="selectGuests(6)">6å</div>
        <div class="guest-btn" data-guests="7" onclick="selectGuests(7)">7å</div>
        <div class="guest-btn" data-guests="8" onclick="selectGuests(8)">8å</div>
        <div class="guest-btn" data-guests="9" onclick="selectGuests(9)">9å</div>
        <div class="guest-btn" data-guests="10" onclick="selectGuests(10)">10å</div>
    </div>
    <div class="navigation">
        <a href="{{ url_for('index') }}" class="btn">
            ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
        </a>
        <button onclick="goToStep2()" class="btn" id="next-step1" disabled>
            æ¬¡ã¸
        </button>
    </div>
</div>

<!-- ã‚¹ãƒ†ãƒƒãƒ—2: æ™‚é–“é¸æŠ -->
<div id="step2" class="step">
    <h2>æ™‚é–“å¸¯ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
    <div class="selected-guests-info">
        <p>é¸æŠã•ã‚ŒãŸäººæ•°: <span id="selected-guests-display">-</span>å</p>
    </div>
    <div class="time-slots" id="filtered-time-slots">
        <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
    </div>
    <div class="navigation">
        <button onclick="goToStep1()" class="btn">
            æˆ»ã‚‹
        </button>
        <button onclick="goToStep3()" class="btn" id="next-step2" disabled>
            æ¬¡ã¸
        </button>
    </div>
</div>

<!-- ã‚¹ãƒ†ãƒƒãƒ—3: ç¢ºèªãƒ»äºˆç´„ -->
<div id="step3" class="step">
    <h2>äºˆç´„å†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„</h2>
    <div class="ticket-info">
        <p><strong>äºˆç´„æ™‚é–“:</strong> <span id="confirm-time"></span></p>
        <p><strong>äººæ•°:</strong> <span id="confirm-guests"></span>å</p>
        <p><strong>äºˆç´„æ—¥:</strong> <span id="confirm-date"></span></p>
    </div>
    
    
    <div class="navigation">
        <button onclick="goToStep2()" class="btn">
            æˆ»ã‚‹
        </button>
        <button onclick="confirmReservation()" class="btn btn-success">
            äºˆç´„ã‚’ç¢ºå®šã™ã‚‹
        </button>
    </div>
</div>

<!-- äºˆç´„å®Œäº† -->
<div id="step4" class="step">
    <h2>äºˆç´„ãŒå®Œäº†ã—ã¾ã—ãŸï¼</h2>
    <div class="ticket">
        <h3>ã‚ãªãŸã®æ•´ç†åˆ¸</h3>
        <div class="qr-code" id="final-qr-code">
            <!-- QRã‚³ãƒ¼ãƒ‰ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
        </div>
        <div class="ticket-info">
            <p><strong>äºˆç´„æ™‚é–“:</strong> <span id="final-time"></span></p>
            <p><strong>äººæ•°:</strong> <span id="final-guests"></span>å</p>
            <p><strong>äºˆç´„æ—¥:</strong> <span id="final-date"></span></p>
        </div>
        <p>ã“ã®ç”»é¢ã‚’ã‚¹ã‚¿ãƒƒãƒ•ã«ãŠè¦‹ã›ãã ã•ã„</p>
        
        <!-- å®Œäº†å¾Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div style="margin-top: 30px; text-align: center;">
            <a href="{{ url_for('index') }}" class="btn" style="background: #008793; color: white; margin: 5px;">
                ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
            </a>
            <a href="{{ url_for('my_ticket') }}" class="btn" style="background: #6c757d; color: white; margin:5px;">
                ãƒã‚±ãƒƒãƒˆã‚’ç¢ºèª
            </a>
        </div>
    </div>
</div>

{% endif %}

<!-- ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆstep1ã¨step2ã§ã®ã¿è¡¨ç¤ºï¼‰ -->
<div class="floating-navigation" id="floating-nav-step1" style="display: none;">
    <a href="{{ url_for('index') }}" class="btn">
        ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
    </a>
    <button onclick="goToStep2()" class="btn" id="floating-next-step1" disabled>
        æ¬¡ã¸é€²ã‚€
    </button>
</div>

<div class="floating-navigation" id="floating-nav-step2" style="display: none;">
    <button onclick="goToStep1()" class="btn">
        æˆ»ã‚‹
    </button>
    <button onclick="goToStep3()" class="btn" id="floating-next-step2" disabled>
        æ¬¡ã¸é€²ã‚€
    </button>
</div>

<div class="floating-navigation" id="floating-nav-step3" style="display: none;">
    <button onclick="goToStep2()" class="btn">
        æˆ»ã‚‹
    </button>
    <button onclick="confirmReservation()" class="btn">
        äºˆç´„ã‚’ç¢ºå®šã™ã‚‹
    </button>
</div>

{% endblock %}

{% block extra_scripts %}
<script>
let selectedTime = null;
let selectedGuests = null;
let availableTimeslots = [];

function selectGuests(guests) {
    document.querySelectorAll('.guest-btn').forEach(btn => {
        btn.classList.remove('selected');
    });
    
    const btn = document.querySelector(`[data-guests="${guests}"]`);
    btn.classList.add('selected');
    
    selectedGuests = guests;
    document.getElementById('next-step1').disabled = false;
    document.getElementById('floating-next-step1').disabled = false;
}

function selectTime(time, available) {
    if (available <= 0) return;
    
    // æ—¢å­˜ã®é¸æŠã‚’è§£é™¤
    document.querySelectorAll('.time-slot').forEach(slot => {
        slot.classList.remove('selected');
    });
    
    // æ–°ã—ã„é¸æŠã‚’è¨­å®š
    const slot = document.querySelector(`[data-time="${time}"]`);
    slot.classList.add('selected');
    
    selectedTime = time;
    
    document.getElementById('next-step2').disabled = false;
    document.getElementById('floating-next-step2').disabled = false;
}

function goToStep1() {
    document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
    document.getElementById('step1').classList.add('active');
    
    document.querySelectorAll('.progress-step').forEach(step => {
        step.classList.remove('active', 'completed');
    });
    document.getElementById('progress-1').classList.add('active');
    
    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡
    document.getElementById('floating-nav-step1').style.display = 'flex';
    document.getElementById('floating-nav-step2').style.display = 'none';
}

async function goToStep2() {
    if (!selectedGuests) return;
    
    document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
    document.getElementById('step2').classList.add('active');
    
    document.getElementById('progress-1').classList.add('completed');
    document.getElementById('progress-1').classList.remove('active');
    document.getElementById('progress-2').classList.add('active');
    
    // é¸æŠã•ã‚ŒãŸäººæ•°ã‚’è¡¨ç¤º
    document.getElementById('selected-guests-display').textContent = selectedGuests;
    
    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡
    document.getElementById('floating-nav-step1').style.display = 'none';
    document.getElementById('floating-nav-step2').style.display = 'flex';
    
    // äººæ•°ã«åŸºã¥ã„ã¦åˆ©ç”¨å¯èƒ½ãªæ™‚é–“å¸¯ã‚’å–å¾—
    try {
        const response = await fetch(`/api/timeslots/${selectedGuests}`);
        const data = await response.json();
        availableTimeslots = data.timeslots;
        
        // æ™‚é–“å¸¯ã‚’è¡¨ç¤º
        const timeSlots = document.getElementById('filtered-time-slots');
        timeSlots.innerHTML = '';
        
        availableTimeslots.forEach(slot => {
            const slotDiv = document.createElement('div');
            slotDiv.className = `time-slot ${slot.available <= 0 ? 'disabled' : ''}`;
            slotDiv.onclick = () => selectTime(slot.time, slot.available);
            slotDiv.setAttribute('data-time', slot.time);
            slotDiv.setAttribute('data-available', slot.available);
            
            slotDiv.innerHTML = `
                <div class="time-text">${slot.time}</div>
                <div class="availability">
                    ${slot.available > 0 ? `ç©ºã: ${slot.available}å` : 'æº€å¸­'}
                </div>
            `;
            
            timeSlots.appendChild(slotDiv);
        });
    } catch (error) {
        console.error('Error fetching timeslots:', error);
        alert('æ™‚é–“å¸¯ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
}

function goToStep3() {
    if (!selectedTime || !selectedGuests) return;
    
    document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
    document.getElementById('step3').classList.add('active');
    
    document.getElementById('progress-2').classList.add('completed');
    document.getElementById('progress-2').classList.remove('active');
    document.getElementById('progress-3').classList.add('active');
    
    // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡
    document.getElementById('floating-nav-step1').style.display = 'none';
    document.getElementById('floating-nav-step2').style.display = 'none';
    document.getElementById('floating-nav-step3').style.display = 'flex';
    
    // ç¢ºèªå†…å®¹ã‚’è¡¨ç¤º
    document.getElementById('confirm-time').textContent = selectedTime;
    document.getElementById('confirm-guests').textContent = selectedGuests;
    document.getElementById('confirm-date').textContent = new Date().toLocaleDateString('ja-JP');
}

async function confirmReservation() {
    try {
        const response = await fetch('/api/reserve', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                time: selectedTime,
                guests: selectedGuests
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            // äºˆç´„å®Œäº†ç”»é¢ã‚’è¡¨ç¤º
            document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
            document.getElementById('step4').classList.add('active');
            
            document.getElementById('progress-3').classList.add('completed');
            
            // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤º
            document.getElementById('floating-nav-step3').style.display = 'none';
            
            // äºˆç´„å†…å®¹ã‚’è¡¨ç¤º
            document.getElementById('final-time').textContent = result.reservation.time;
            document.getElementById('final-guests').textContent = result.reservation.guests;
            document.getElementById('final-date').textContent = result.reservation.date;
            
            // QRã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
            const qrCodeDiv = document.getElementById('final-qr-code');
            qrCodeDiv.innerHTML = `<img src="${result.reservation.qr_code_image}" alt="QRã‚³ãƒ¼ãƒ‰">`;
            
            // å³åº§ã«my-ticketãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
            window.location.href = `${window.location.origin}/my-ticket`;
        } else {
            alert('äºˆç´„ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('äºˆç´„ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    }
}

async function cancelReservation() {
    if (!confirm('äºˆç´„ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ')) return;
    
    try {
        const response = await fetch('/api/cancel', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('äºˆç´„ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ');
            location.reload();
        } else {
            alert('ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('ã‚­ãƒ£ãƒ³ã‚»ãƒ«ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    }
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸè¨­å®š
document.addEventListener('DOMContentLoaded', function() {
    // åˆæœŸçŠ¶æ…‹ã§ã¯step1ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã®ã§ã€step1ã®ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
    const step1Element = document.getElementById('step1');
    if (step1Element && step1Element.classList.contains('active')) {
        document.getElementById('floating-nav-step1').style.display = 'flex';
    }
    
    // æ—¢å­˜ã®äºˆç´„ãŒã‚ã‚‹å ´åˆã€SSEæ¥ç¶šã‚’é–‹å§‹
    if (document.querySelector('.ticket')) {
        initSSE();
    }
});

function initSSE() {
    if (typeof(EventSource) !== "undefined") {
        const eventSource = new EventSource('/events');
        
        eventSource.onmessage = function(event) {
            try {
                const data = JSON.parse(event.data);
                handleSSEEvent(data);
            } catch (e) {
                console.error('SSE data parse error:', e);
            }
        };
        
        eventSource.onerror = function(event) {
            console.log('SSE connection error, retrying in 5 seconds...');
            eventSource.close();
            setTimeout(initSSE, 5000);
        };
        
        console.log('SSE connection established');
    } else {
        console.log('Server-Sent Events not supported');
    }
}

function handleSSEEvent(data) {
    console.log('SSE Event received:', data);
    
    switch(data.event) {
        case 'checkin_completed':
            // ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³å®Œäº†é€šçŸ¥ã‚’å—ä¿¡ã—ãŸå ´åˆã€å—ä»˜å®Œäº†ç”»é¢ã«é·ç§»
            showCheckinCompletedMessage();
            setTimeout(() => {
                window.location.href = '/checkin-complete?qr=' + data.data.qr_code;
            }, 2000);
            break;
            
        case 'connected':
            console.log('SSEæ¥ç¶šç¢ºç«‹:', data.data);
            break;
            
        case 'heartbeat':
            // ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆ - ä½•ã‚‚ã—ãªã„
            break;
            
        default:
            console.log('æœªçŸ¥ã®SSEã‚¤ãƒ™ãƒ³ãƒˆ:', data);
    }
}

function showCheckinCompletedMessage() {
    // ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
    const message = document.createElement('div');
    message.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 30px;
        border-radius: 15px;
        text-align: center;
        z-index: 10000;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        animation: bounceIn 0.8s ease-out;
    `;
    message.innerHTML = `
        <div style="font-size: 3em; margin-bottom: 15px;">ğŸŠ</div>
        <h2 style="margin: 0 0 10px 0;">å—ä»˜å®Œäº†ï¼</h2>
        <p style="margin: 0; font-size: 1.1em;">ã¾ã‚‚ãªãå—ä»˜å®Œäº†ç”»é¢ã«ç§»å‹•ã—ã¾ã™...</p>
    `;
    
    document.body.appendChild(message);
    
    // ãƒã‚¦ãƒ³ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
    if (!document.getElementById('bounce-animation-style')) {
        const style = document.createElement('style');
        style.id = 'bounce-animation-style';
        style.textContent = `
            @keyframes bounceIn {
                0% {
                    transform: translate(-50%, -50%) scale(0.3);
                    opacity: 0;
                }
                50% {
                    transform: translate(-50%, -50%) scale(1.05);
                }
                70% {
                    transform: translate(-50%, -50%) scale(0.9);
                }
                100% {
                    transform: translate(-50%, -50%) scale(1);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);
    }
    
    // 3ç§’å¾Œã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
    setTimeout(() => {
        if (message.parentNode) {
            message.parentNode.removeChild(message);
        }
    }, 3000);
}
</script>
{% endblock %}