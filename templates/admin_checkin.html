{% extends "base.html" %}

{% block title %}ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ - æµ·åº•äºŒä¸‡ãƒã‚¤ãƒ«{% endblock %}

{% block extra_styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin_checkin.css') }}">
{% endblock %}

{% block content %}
<div class="nav-back">
    <a href="/admin" class="btn">
        <span class="emoji">â—€ï¸</span> ç®¡ç†ç”»é¢ã«æˆ»ã‚‹
    </a>
</div>

<div class="checkin-container">
    <h1><span class="emoji">âœ…</span>ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ç¢ºèª</h1>
    
    <div class="checkin-info">
        <h3><span class="emoji">ğŸ«</span>äºˆç´„æƒ…å ±</h3>
        <div class="info-item">
            <span class="info-label">æ™‚é–“å¸¯:</span>
            <span class="info-value">{{ time }}</span>
        </div>
        <div class="info-item">
            <span class="info-label">äººæ•°:</span>
            <span class="info-value">{{ guests }}å</span>
        </div>
        <div class="info-item">
            <span class="info-label">æ—¥ä»˜:</span>
            <span class="info-value" id="current-date"></span>
        </div>
    </div>
    
    <div id="checkin-form">
        <p>ã“ã®äºˆç´„ã§ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã‚’è¡Œã„ã¾ã™ã‹ï¼Ÿ</p>
        <div class="checkin-actions">
            <button onclick="performCheckin()" class="btn btn-success">
                <span class="emoji">âœ…</span> ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³å®Ÿè¡Œ
            </button>
            <a href="/admin" class="btn">
                <span class="emoji">âŒ</span> ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            </a>
        </div>
    </div>
    
    <div id="success-message" class="success-message hidden">
        <h3><span class="emoji">ğŸ‰</span>ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³å®Œäº†ï¼</h3>
        <p>{{ guests }}åã®ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ãŒå®Œäº†ã—ã¾ã—ãŸã€‚</p>
        <div class="mt-20">
            <a href="/admin" class="btn">
                <span class="emoji">ğŸ </span> ç®¡ç†ç”»é¢ã«æˆ»ã‚‹
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// ç¾åœ¨ã®æ—¥ä»˜ã‚’è¡¨ç¤º
document.getElementById('current-date').textContent = new Date().toLocaleDateString('ja-JP');

async function performCheckin() {
    const time = "{{ time }}";
    const guests = {{ guests }};
    
    try {
        const response = await fetch('/api/checkin', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                time: time,
                guests: guests
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            // ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æˆåŠŸ
            document.getElementById('checkin-form').classList.add('hidden');
            document.getElementById('success-message').classList.remove('hidden');
            
            // 3ç§’å¾Œã«ç®¡ç†ç”»é¢ã«æˆ»ã‚‹
            setTimeout(() => {
                window.location.href = '/admin';
            }, 3000);
        } else {
            alert('ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    }
}
</script>
{% endblock %} 