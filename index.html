<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êµ∑Â∫ï‰∫å‰∏á„Éû„Ç§„É´ - Êï¥ÁêÜÂà∏‰∫àÁ¥Ñ</title>
    <!-- QR„Ç≥„Éº„ÉâÁîüÊàêÁî®„ÅÆ„É©„Ç§„Éñ„É©„É™„ÇíËøΩÂä† -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(to bottom, #dbeafe, #cffafe);
            min-height: 100vh;
            color: #374151;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(to right, #2563eb, #0891b2);
            color: white;
            padding: 24px;
            border-radius: 0 0 24px 24px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header-icon {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            vertical-align: middle;
        }

        .header h1 {
            font-size: 20px;
            font-weight: bold;
            display: inline;
        }

        .header p {
            color: #bfdbfe;
            font-size: 14px;
            margin-top: 4px;
        }

        .content {
            padding: 24px;
            background: linear-gradient(to bottom, #f0f9ff, #e0f2fe);
            min-height: calc(100vh - 120px);
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
            margin-bottom: 24px;
        }

        .card h2 {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
        }

        .card h2::before {
            content: 'üïí';
            margin-right: 8px;
        }

        .card.step2 h2::before {
            content: 'üë•';
        }

        .card.step3 h2::before {
            content: '‚úÖ';
        }

        .time-slot {
            width: 100%;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .time-slot:hover:not(:disabled) {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .time-slot.selected {
            border-color: #2563eb;
            background: #dbeafe;
            box-shadow: 0 2px 4px rgba(37, 99, 235, 0.2);
        }

        .time-slot:disabled {
            background: #f9fafb;
            color: #9ca3af;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .time-info {
            text-align: left;
        }

        .time-text {
            font-weight: 600;
            font-size: 16px;
        }

        .availability {
            font-size: 14px;
            margin-top: 4px;
        }

        .available {
            color: #16a34a;
        }

        .warning {
            color: #f59e0b;
        }

        .full {
            color: #dc2626;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .dot-green {
            background: #16a34a;
        }

        .dot-yellow {
            background: #f59e0b;
        }

        .dot-red {
            background: #dc2626;
        }

        .counter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin: 32px 0;
        }

        .counter-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #f3f4f6;
            border: none;
            font-size: 24px;
            font-weight: bold;
            color: #6b7280;
            cursor: pointer;
            transition: background 0.2s;
        }

        .counter-btn:hover {
            background: #e5e7eb;
        }

        .counter-display {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #dbeafe;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            color: #2563eb;
        }

        .btn {
            width: 100%;
            padding: 16px;
            border-radius: 16px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(to right, #2563eb, #0891b2);
            color: white;
            box-shadow: 0 4px 6px rgba(37, 99, 235, 0.3);
        }

        .btn-primary:hover {
            box-shadow: 0 6px 8px rgba(37, 99, 235, 0.4);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-group {
            display: flex;
            gap: 12px;
        }

        .btn-group .btn {
            flex: 1;
        }

        .ticket {
            background: white;
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 8px 12px rgba(0,0,0,0.1);
            border: 2px dashed #3b82f6;
            text-align: center;
            margin-bottom: 24px;
        }

        .qr-placeholder {
            width: 80px;
            height: 80px;
            background: #f3f4f6;
            border-radius: 16px;
            margin: 16px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #6b7280;
        }

        .qr-placeholder::before {
            content: 'üì±';
            font-size: 48px;
        }

        .ticket-info {
            margin-top: 24px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #6b7280;
        }

        .info-value {
            font-weight: bold;
        }

        .info-value.time {
            color: #2563eb;
        }

        .warning-box {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .warning-title {
            font-weight: bold;
            color: #92400e;
            margin-bottom: 8px;
        }

        .warning-list {
            color: #92400e;
            font-size: 14px;
            line-height: 1.5;
        }

        .hidden {
            display: none;
        }

        .text-center {
            text-align: center;
        }

        .mb-4 {
            margin-bottom: 16px;
        }

        .text-sm {
            font-size: 14px;
            color: #6b7280;
        }

        /* „ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥ÂÆå‰∫ÜÁîªÈù¢„ÅÆ„Çπ„Çø„Ç§„É´ */
        #step4 {
            display: none;
        }

        .check-in-success {
            text-align: center;
            padding: 32px 0;
        }

        .check-in-icon {
            font-size: 64px;
            margin-bottom: 24px;
        }

        .check-in-message {
            font-size: 24px;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 16px;
        }

        .check-in-details {
            color: #6b7280;
            margin-bottom: 32px;
        }
    </style>
    <!-- QR„Ç≥„Éº„ÉâË™≠„ÅøÂèñ„ÇäÁî®„ÅÆ„É©„Ç§„Éñ„É©„É™„ÇíËøΩÂä† -->
    <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>
    <div class="container">
        <!-- „Çπ„ÉÜ„ÉÉ„Éó1: ÊôÇÈñìÈÅ∏Êäû -->
        <div id="step1">
            <div class="header">
                <div class="header-icon">üåä</div>
                <div style="display: inline-block;">
                    <h1>Êµ∑Â∫ï‰∫å‰∏á„Éû„Ç§„É´</h1>
                    <p>„ÇØ„É©„Çπ‰ºÅÁîª 3-A</p>
                </div>
            </div>
            <div class="content">
                <div class="card">
                    <h2>ÊôÇÈñìÂ∏Ø„ÇíÈÅ∏Êäû</h2>
                    <p class="text-sm mb-4">„ÅîÂ∏åÊúõ„ÅÆ30ÂàÜÊû†„Çí„ÅäÈÅ∏„Å≥„Åè„Å†„Åï„ÅÑ</p>
                    <div id="timeSlots"></div>
                </div>
                <button class="btn btn-primary hidden" id="nextBtn1" onclick="goToStep2()">
                    Ê¨°„Å∏ÈÄ≤„ÇÄ
                </button>
            </div>
        </div>

        <!-- „Çπ„ÉÜ„ÉÉ„Éó2: ‰∫∫Êï∞ÈÅ∏Êäû -->
        <div id="step2" class="hidden">
            <div class="header">
                <div class="header-icon">üë•</div>
                <div style="display: inline-block;">
                    <h1>‰∫∫Êï∞„ÇíÈÅ∏Êäû</h1>
                    <p id="selectedTimeDisplay"></p>
                </div>
            </div>
            <div class="content">
                <div class="card step2">
                    <h2>Êù•Â†¥‰∫∫Êï∞</h2>
                    <p class="text-sm mb-4">ÊúÄÂ§ß5‰∫∫„Åæ„ÅßÂêåÊôÇ‰∫àÁ¥ÑÂèØËÉΩ„Åß„Åô</p>
                    
                    <div class="counter">
                        <button class="counter-btn" onclick="changeGuestCount(-1)">‚àí</button>
                        <div class="counter-display" id="guestDisplay">1</div>
                        <button class="counter-btn" onclick="changeGuestCount(1)">Ôºã</button>
                    </div>
                    
                    <div class="text-center text-sm" id="remainingSlots"></div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goToStep1()">Êàª„Çã</button>
                    <button class="btn btn-primary" onclick="makeReservation()">Êï¥ÁêÜÂà∏„ÇíÁô∫Âà∏</button>
                </div>
            </div>
        </div>

        <!-- „Çπ„ÉÜ„ÉÉ„Éó3: Êï¥ÁêÜÂà∏Ë°®Á§∫ -->
        <div id="step3" class="hidden">
            <div class="header" style="background: linear-gradient(to right, #16a34a, #2563eb);">
                <div class="header-icon">‚úÖ</div>
                <div style="display: inline-block;">
                    <h1>‰∫àÁ¥ÑÂÆå‰∫ÜÔºÅ</h1>
                    <p>Êï¥ÁêÜÂà∏„ÅåÁô∫Âà∏„Åï„Çå„Åæ„Åó„Åü</p>
                </div>
            </div>
            <div class="content" style="background: linear-gradient(to bottom, #dcfce7, #dbeafe);">
                <div class="ticket">
                    <h2 style="margin-bottom: 8px;">Êµ∑Â∫ï‰∫å‰∏á„Éû„Ç§„É´</h2>
                    <div id="qrcode" class="qr-placeholder"></div>
                    <p class="text-sm">QR„Ç≥„Éº„ÉâÔºàÂÖ•Â†¥ÊôÇ„Å´ÊèêÁ§∫Ôºâ</p>
                    
                    <div class="ticket-info">
                        <div class="info-row">
                            <span class="info-label">‰∫àÁ¥ÑÊôÇÈñì</span>
                            <span class="info-value time" id="ticketTime"></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">‰∫∫Êï∞</span>
                            <span class="info-value" id="ticketGuests"></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">‰∫àÁ¥ÑÊó•</span>
                            <span class="info-value" id="ticketDate"></span>
                        </div>
                    </div>
                </div>

                <div class="warning-box">
                    <div class="warning-title">‚ö†Ô∏è ÈáçË¶Å„Å™Ê≥®ÊÑè‰∫ãÈ†Ö</div>
                    <div class="warning-list">
                        ‚Ä¢ „Åì„ÅÆÁîªÈù¢„Çí„Çπ„ÇØ„É™„Éº„É≥„Ç∑„Éß„ÉÉ„Éà„Åß‰øùÂ≠ò„Åó„Å¶„Åè„Å†„Åï„ÅÑ<br>
                        ‚Ä¢ ‰∫àÁ¥ÑÊôÇÈñì„ÅÆ5ÂàÜÂâç„Åæ„Åß„Å´„ÅäË∂ä„Åó„Åè„Å†„Åï„ÅÑ<br>
                        ‚Ä¢ ÂÖ•Â†¥ÊôÇ„Å´QR„Ç≥„Éº„Éâ„ÇíÊèêÁ§∫„Åó„Å¶„Åè„Å†„Åï„ÅÑ<br>
                        ‚Ä¢ ÈÅÖ„Çå„ÅüÂ†¥Âêà„ÅØÊ¨°„ÅÆÊôÇÈñìÂ∏Ø„Åß„ÅÆÊ°àÂÜÖ„Å®„Å™„Çä„Åæ„Åô
                    </div>
                </div>

                <div style="margin-top: 24px;">
                    <button class="btn btn-secondary" onclick="cancelReservation()">
                        ‰∫àÁ¥Ñ„Çí„Ç≠„É£„É≥„Çª„É´
                    </button>
                </div>
            </div>
        </div>

        <!-- „Çπ„ÉÜ„ÉÉ„Éó4: „ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥ÂÆå‰∫Ü -->
        <div id="step4" class="hidden">
            <div class="header" style="background: linear-gradient(to right, #16a34a, #059669);">
                <div class="header-icon">üéâ</div>
                <div style="display: inline-block;">
                    <h1>„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥ÂÆå‰∫Ü</h1>
                    <p>„ÅîÊù•Â†¥„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô</p>
                </div>
            </div>
            <div class="content" style="background: linear-gradient(to bottom, #dcfce7, #d1fae5);">
                <div class="check-in-success">
                    <div class="check-in-icon">‚ú®</div>
                    <div class="check-in-message">„ÉÅ„Çß„ÉÉ„ÇØ„Ç§„É≥„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü</div>
                    <div class="check-in-details">
                        <p>„ÅîÊù•Â†¥„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ</p>
                        <p>„Çπ„Çø„ÉÉ„Éï„Åå„ÅîÊ°àÂÜÖ„ÅÑ„Åü„Åó„Åæ„Åô„ÅÆ„Åß„ÄÅ„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        var selectedTime = '';
        var guestCount = 1;
        var reservationData = null;

        var timeSlots = [
            { time: '10:00 - 10:30', available: 8, total: 15 },
            { time: '10:30 - 11:00', available: 12, total: 15 },
            { time: '11:00 - 11:30', available: 5, total: 15 },
            { time: '11:30 - 12:00', available: 0, total: 15 },
            { time: '12:00 - 12:30', available: 3, total: 15 },
            { time: '12:30 - 13:00', available: 0, total: 15 },
            { time: '13:00 - 13:30', available: 7, total: 15 },
            { time: '13:30 - 14:00', available: 10, total: 15 },
            { time: '14:00 - 14:30', available: 9, total: 15 },
            { time: '14:30 - 15:00', available: 15, total: 15 }
        ];

        document.addEventListener('DOMContentLoaded', function() {
            loadTimeSlots();
            checkExistingReservation();
            renderTimeSlots();
        });

        // Êó¢Â≠ò„ÅÆ‰∫àÁ¥Ñ„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Å¶„ÄÅ„ÅÇ„Çå„Å∞‰∫àÁ¥ÑÂÆå‰∫ÜÁîªÈù¢„Å´ÈÅ∑Áßª
        function checkExistingReservation() {
            var reservations = JSON.parse(localStorage.getItem('reservations') || '[]');
            var activeReservation = null;
            
            // ÊúÄÊñ∞„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„Éñ„Å™‰∫àÁ¥Ñ„ÇíÂèñÂæó
            for (var i = reservations.length - 1; i >= 0; i--) {
                if (reservations[i].status === 'active') {
                    activeReservation = reservations[i];
                    break;
                }
            }
            
            if (activeReservation) {
                // ‰∫àÁ¥Ñ„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ
                reservationData = {
                    time: activeReservation.time,
                    guests: activeReservation.guests,
                    qrCode: 'QR-' + activeReservation.time.replace(/[:\s-]/g, '') + '-' + activeReservation.guests,
                    date: activeReservation.date,
                    slotIndex: timeSlots.findIndex(slot => slot.time === activeReservation.time)
                };
                
                // „Åæ„ÅöÂÖ®„Å¶„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÇíÈùûË°®Á§∫„Å´„Åô„Çã
                document.getElementById('step1').classList.add('hidden');
                document.getElementById('step2').classList.add('hidden');
                document.getElementById('step3').classList.add('hidden');
                document.getElementById('step4').classList.add('hidden');
                
                // ‰∫àÁ¥ÑÂÆå‰∫ÜÁîªÈù¢„ÅÆÂÜÖÂÆπ„ÇíË®≠ÂÆö
                document.getElementById('ticketTime').textContent = reservationData.time;
                document.getElementById('ticketGuests').textContent = reservationData.guests + '‰∫∫';
                document.getElementById('ticketDate').textContent = reservationData.date;
                
                // QR„Ç≥„Éº„Éâ„ÇíÁîüÊàêÔºà„É©„Ç§„Éñ„É©„É™„ÅåË™≠„ÅøËæº„Åæ„Çå„ÅüÂæå„Å´ÂÆüË°åÔºâ
                setTimeout(function() {
                    var qrcodeElement = document.getElementById("qrcode");
                    qrcodeElement.innerHTML = '';
                    if (typeof QRCode !== 'undefined') {
                        new QRCode(qrcodeElement, {
                            text: reservationData.qrCode,
                            width: 128,
                            height: 128,
                            colorDark: "#000000",
                            colorLight: "#ffffff",
                            correctLevel: QRCode.CorrectLevel.H
                        });
                    }
                }, 100);
                
                // ‰∫àÁ¥ÑÂÆå‰∫ÜÁîªÈù¢„ÅÆ„Åø„ÇíË°®Á§∫
                document.getElementById('step3').classList.remove('hidden');
            }
        }

        // localStorage„Åã„ÇâÊôÇÈñìÂ∏Ø„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
        function loadTimeSlots() {
            var savedSlots = localStorage.getItem('timeSlots');
            if (savedSlots) {
                timeSlots = JSON.parse(savedSlots);
            }
        }

        // localStorage„Å´ÊôÇÈñìÂ∏Ø„Éá„Éº„Çø„Çí‰øùÂ≠ò
        function saveTimeSlots() {
            localStorage.setItem('timeSlots', JSON.stringify(timeSlots));
        }

        function renderTimeSlots() {
            var container = document.getElementById('timeSlots');
            container.innerHTML = '';

            for (var i = 0; i < timeSlots.length; i++) {
                var slot = timeSlots[i];
                var isAvailable = slot.available >= guestCount;
                var isFull = slot.available === 0;
                
                var button = document.createElement('button');
                button.className = 'time-slot';
                button.disabled = !isAvailable;
                
                if (selectedTime === slot.time) {
                    button.classList.add('selected');
                }

                var statusClass = 'available';
                var dotClass = 'dot-green';
                var statusText = 'ÊÆã„Çä' + slot.available + '‰∫∫';

                if (isFull) {
                    statusClass = 'full';
                    dotClass = 'dot-red';
                    statusText = 'Ê∫ÄÂì°';
                } else if (slot.available <= 5) {
                    statusClass = 'warning';
                    dotClass = 'dot-yellow';
                }

                button.innerHTML = '<div class="time-info"><div class="time-text">' + slot.time + '</div><div class="availability ' + statusClass + '">' + statusText + '</div></div><div class="status-dot ' + dotClass + '"></div>';

                if (isAvailable) {
                    button.onclick = createSelectTimeFunction(slot.time);
                }

                container.appendChild(button);
            }
        }

        function createSelectTimeFunction(time) {
            return function() {
                selectTime(time);
            };
        }

        function selectTime(time) {
            selectedTime = time;
            renderTimeSlots();
            document.getElementById('nextBtn1').classList.remove('hidden');
        }

        function goToStep1() {
            document.getElementById('step1').classList.remove('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('step4').classList.add('hidden');
        }

        function goToStep2() {
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.remove('hidden');
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('step4').classList.add('hidden');
            document.getElementById('selectedTimeDisplay').textContent = 'ÈÅ∏ÊäûÊôÇÈñì: ' + selectedTime;
            updateRemainingSlots();
        }

        function goToStep3() {
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.remove('hidden');
            document.getElementById('step4').classList.add('hidden');
        }

        function changeGuestCount(delta) {
            var selectedSlot = null;
            for (var i = 0; i < timeSlots.length; i++) {
                if (timeSlots[i].time === selectedTime) {
                    selectedSlot = timeSlots[i];
                    break;
                }
            }
            
            var maxGuests = Math.min(5, selectedSlot.available);
            guestCount = Math.max(1, Math.min(maxGuests, guestCount + delta));
            document.getElementById('guestDisplay').textContent = guestCount;
            updateRemainingSlots();
        }

        function updateRemainingSlots() {
            var selectedSlot = null;
            for (var i = 0; i < timeSlots.length; i++) {
                if (timeSlots[i].time === selectedTime) {
                    selectedSlot = timeSlots[i];
                    break;
                }
            }
            document.getElementById('remainingSlots').textContent = '„Åì„ÅÆÊôÇÈñìÂ∏Ø„ÅÆÊÆã„ÇäÊû†: ' + selectedSlot.available + '‰∫∫';
        }



        function makeReservation() {
            var selectedSlot = null;
            for (var i = 0; i < timeSlots.length; i++) {
                if (timeSlots[i].time === selectedTime) {
                    selectedSlot = timeSlots[i];
                    break;
                }
            }
            
            reservationData = {
                time: selectedTime,
                guests: guestCount,
                qrCode: 'QR-' + selectedTime.replace(/[:\s-]/g, '') + '-' + guestCount,
                date: new Date().toLocaleDateString('ja-JP'),
                slotIndex: timeSlots.findIndex(slot => slot.time === selectedTime)
            };

            selectedSlot.available -= guestCount;
            
            // ‰∫àÁ¥Ñ„Éá„Éº„Çø„ÇílocalStorage„Å´‰øùÂ≠ò
            var reservations = JSON.parse(localStorage.getItem('reservations') || '[]');
            reservations.push({
                time: reservationData.time,
                guests: reservationData.guests,
                date: reservationData.date,
                status: 'active'
            });
            localStorage.setItem('reservations', JSON.stringify(reservations));
            
            // ÊôÇÈñìÂ∏Ø„Éá„Éº„Çø„ÇÇ‰øùÂ≠ò
            saveTimeSlots();

            document.getElementById('ticketTime').textContent = reservationData.time;
            document.getElementById('ticketGuests').textContent = reservationData.guests + '‰∫∫';
            document.getElementById('ticketDate').textContent = reservationData.date;

            // QR„Ç≥„Éº„Éâ„ÇíÁîüÊàê
            var qrcodeElement = document.getElementById("qrcode");
            qrcodeElement.innerHTML = ''; // Êó¢Â≠ò„ÅÆQR„Ç≥„Éº„Éâ„Çí„ÇØ„É™„Ç¢
            new QRCode(qrcodeElement, {
                text: reservationData.qrCode,
                width: 128,
                height: 128,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });

            goToStep3();
        }

        // QR„Ç≥„Éº„ÉâË™≠„ÅøÂèñ„ÇäÊ©üËÉΩ„ÅÆÂàùÊúüÂåñ
        function initQRScanner() {
            const html5QrCode = new Html5Qrcode("qr-reader");
            const qrCodeSuccessCallback = (decodedText, decodedResult) => {
                if (decodedText.startsWith('QR-')) {
                    html5QrCode.stop().then(() => {
                        goToStep4();
                    });
                }
            };
            const config = { fps: 10, qrbox: { width: 250, height: 250 } };
            html5QrCode.start({ facingMode: "environment" }, config, qrCodeSuccessCallback);
        }

        function goToStep4() {
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('step4').classList.remove('hidden');
        }

        function cancelReservation() {
            if (confirm('‰∫àÁ¥Ñ„Çí„Ç≠„É£„É≥„Çª„É´„Åó„Åæ„Åô„ÅãÔºü\n„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åô„Åì„Å®„Åå„Åß„Åç„Åæ„Åõ„Çì„ÄÇ')) {
                if (reservationData && reservationData.slotIndex !== -1) {
                    // ÊôÇÈñìÂ∏Ø„ÅÆÁ©∫„Åç„ÇíÊàª„Åô
                    timeSlots[reservationData.slotIndex].available += reservationData.guests;
                    saveTimeSlots();
                    
                    // ‰∫àÁ¥ÑÂ±•Ê≠¥„ÇíÊõ¥Êñ∞Ôºà„Çπ„ÉÜ„Éº„Çø„Çπ„Çí„Ç≠„É£„É≥„Çª„É´„Å´Â§âÊõ¥Ôºâ
                    var reservations = JSON.parse(localStorage.getItem('reservations') || '[]');
                    for (var i = reservations.length - 1; i >= 0; i--) {
                        if (reservations[i].time === reservationData.time && 
                            reservations[i].guests === reservationData.guests && 
                            reservations[i].status === 'active') {
                            reservations[i].status = 'cancelled';
                            break;
                        }
                    }
                    localStorage.setItem('reservations', JSON.stringify(reservations));
                }
                
                // ÁîªÈù¢„Çí„É™„Çª„ÉÉ„Éà„Åó„Å¶Êñ∞„Åó„ÅÑ‰∫àÁ¥Ñ„ÇíÂèØËÉΩ„Å´„Åô„Çã
                selectedTime = '';
                guestCount = 1;
                reservationData = null;
                document.getElementById('guestDisplay').textContent = '1';
                document.getElementById('nextBtn1').classList.add('hidden');
                
                // ÂÖ®„Å¶„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó„ÇíÈùûË°®Á§∫„Å´„Åó„Å¶„Åã„Çâ„Çπ„ÉÜ„ÉÉ„Éó1„ÅÆ„Åø„ÇíË°®Á§∫
                document.getElementById('step1').classList.add('hidden');
                document.getElementById('step2').classList.add('hidden');
                document.getElementById('step3').classList.add('hidden');
                document.getElementById('step4').classList.add('hidden');
                
                document.getElementById('step1').classList.remove('hidden');
                renderTimeSlots();
                
                alert('‰∫àÁ¥Ñ„Åå„Ç≠„É£„É≥„Çª„É´„Åï„Çå„Åæ„Åó„Åü„ÄÇÊñ∞„Åó„ÅÑ‰∫àÁ¥Ñ„Åå„Åß„Åç„Åæ„Åô„ÄÇ');
            }
        }


    </script>
</body>
</html>