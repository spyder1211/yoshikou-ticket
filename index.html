<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ·åº•äºŒä¸‡ãƒã‚¤ãƒ« - æ•´ç†åˆ¸äºˆç´„</title>
    <!-- QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆç”¨ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(to bottom, #dbeafe, #cffafe);
            min-height: 100vh;
            color: #374151;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(to right, #2563eb, #0891b2);
            color: white;
            padding: 24px;
            border-radius: 0 0 24px 24px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header-icon {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            vertical-align: middle;
        }

        .header h1 {
            font-size: 20px;
            font-weight: bold;
            display: inline;
        }

        .header p {
            color: #bfdbfe;
            font-size: 14px;
            margin-top: 4px;
        }

        .content {
            padding: 24px;
            background: linear-gradient(to bottom, #f0f9ff, #e0f2fe);
            min-height: calc(100vh - 120px);
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
            margin-bottom: 24px;
        }

        .card h2 {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
        }

        .card h2::before {
            content: 'ğŸ•’';
            margin-right: 8px;
        }

        .card.step2 h2::before {
            content: 'ğŸ‘¥';
        }

        .card.step3 h2::before {
            content: 'âœ…';
        }

        .time-slot {
            width: 100%;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .time-slot:hover:not(:disabled) {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .time-slot.selected {
            border-color: #2563eb;
            background: #dbeafe;
            box-shadow: 0 2px 4px rgba(37, 99, 235, 0.2);
        }

        .time-slot:disabled {
            background: #f9fafb;
            color: #9ca3af;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .time-info {
            text-align: left;
        }

        .time-text {
            font-weight: 600;
            font-size: 16px;
        }

        .availability {
            font-size: 14px;
            margin-top: 4px;
        }

        .available {
            color: #16a34a;
        }

        .warning {
            color: #f59e0b;
        }

        .full {
            color: #dc2626;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .dot-green {
            background: #16a34a;
        }

        .dot-yellow {
            background: #f59e0b;
        }

        .dot-red {
            background: #dc2626;
        }

        .counter {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin: 32px 0;
        }

        .counter-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: #f3f4f6;
            border: none;
            font-size: 24px;
            font-weight: bold;
            color: #6b7280;
            cursor: pointer;
            transition: background 0.2s;
        }

        .counter-btn:hover {
            background: #e5e7eb;
        }

        .counter-display {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #dbeafe;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            color: #2563eb;
        }

        .btn {
            width: 100%;
            padding: 16px;
            border-radius: 16px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(to right, #2563eb, #0891b2);
            color: white;
            box-shadow: 0 4px 6px rgba(37, 99, 235, 0.3);
        }

        .btn-primary:hover {
            box-shadow: 0 6px 8px rgba(37, 99, 235, 0.4);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-group {
            display: flex;
            gap: 12px;
        }

        .btn-group .btn {
            flex: 1;
        }

        .ticket {
            background: white;
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 8px 12px rgba(0,0,0,0.1);
            border: 2px dashed #3b82f6;
            text-align: center;
            margin-bottom: 24px;
        }

        .qr-placeholder {
            width: 80px;
            height: 80px;
            background: #f3f4f6;
            border-radius: 16px;
            margin: 16px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #6b7280;
        }

        .qr-placeholder::before {
            content: 'ğŸ“±';
            font-size: 48px;
        }

        .ticket-info {
            margin-top: 24px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #6b7280;
        }

        .info-value {
            font-weight: bold;
        }

        .info-value.time {
            color: #2563eb;
        }

        .warning-box {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .warning-title {
            font-weight: bold;
            color: #92400e;
            margin-bottom: 8px;
        }

        .warning-list {
            color: #92400e;
            font-size: 14px;
            line-height: 1.5;
        }

        .hidden {
            display: none;
        }

        .text-center {
            text-align: center;
        }

        .mb-4 {
            margin-bottom: 16px;
        }

        .text-sm {
            font-size: 14px;
            color: #6b7280;
        }

        /* ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³å®Œäº†ç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #step4 {
            display: none;
        }

        .check-in-success {
            text-align: center;
            padding: 32px 0;
        }

        .check-in-icon {
            font-size: 64px;
            margin-bottom: 24px;
        }

        .check-in-message {
            font-size: 24px;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 16px;
        }

        .check-in-details {
            color: #6b7280;
            margin-bottom: 32px;
        }
    </style>
    <!-- QRã‚³ãƒ¼ãƒ‰èª­ã¿å–ã‚Šç”¨ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ  -->
    <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>
    <div class="container">
        <!-- ã‚¹ãƒ†ãƒƒãƒ—1: æ™‚é–“é¸æŠ -->
        <div id="step1">
            <div class="header">
                <div class="header-icon">ğŸŒŠ</div>
                <div style="display: inline-block;">
                    <h1>æµ·åº•äºŒä¸‡ãƒã‚¤ãƒ«</h1>
                    <p>ã‚¯ãƒ©ã‚¹ä¼ç”» 3-A</p>
                </div>
            </div>
            <div class="content">
                <div class="card">
                    <h2>æ™‚é–“å¸¯ã‚’é¸æŠ</h2>
                    <p class="text-sm mb-4">ã”å¸Œæœ›ã®30åˆ†æ ã‚’ãŠé¸ã³ãã ã•ã„</p>
                    <div id="timeSlots"></div>
                </div>
                <button class="btn btn-primary hidden" id="nextBtn1" onclick="goToStep2()">
                    æ¬¡ã¸é€²ã‚€
                </button>
            </div>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—2: äººæ•°é¸æŠ -->
        <div id="step2" class="hidden">
            <div class="header">
                <div class="header-icon">ğŸ‘¥</div>
                <div style="display: inline-block;">
                    <h1>äººæ•°ã‚’é¸æŠ</h1>
                    <p id="selectedTimeDisplay"></p>
                </div>
            </div>
            <div class="content">
                <div class="card step2">
                    <h2>æ¥å ´äººæ•°</h2>
                    <p class="text-sm mb-4">æœ€å¤§5äººã¾ã§åŒæ™‚äºˆç´„å¯èƒ½ã§ã™</p>
                    
                    <div class="counter">
                        <button class="counter-btn" onclick="changeGuestCount(-1)">âˆ’</button>
                        <div class="counter-display" id="guestDisplay">1</div>
                        <button class="counter-btn" onclick="changeGuestCount(1)">ï¼‹</button>
                    </div>
                    
                    <div class="text-center text-sm" id="remainingSlots"></div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-secondary" onclick="goToStep1()">æˆ»ã‚‹</button>
                    <button class="btn btn-primary" onclick="makeReservation()">æ•´ç†åˆ¸ã‚’ç™ºåˆ¸</button>
                </div>
            </div>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—3: æ•´ç†åˆ¸è¡¨ç¤º -->
        <div id="step3" class="hidden">
            <div class="header" style="background: linear-gradient(to right, #16a34a, #2563eb);">
                <div class="header-icon">âœ…</div>
                <div style="display: inline-block;">
                    <h1>äºˆç´„å®Œäº†ï¼</h1>
                    <p>æ•´ç†åˆ¸ãŒç™ºåˆ¸ã•ã‚Œã¾ã—ãŸ</p>
                </div>
            </div>
            <div class="content" style="background: linear-gradient(to bottom, #dcfce7, #dbeafe);">
                <div class="ticket">
                    <h2 style="margin-bottom: 8px;">æµ·åº•äºŒä¸‡ãƒã‚¤ãƒ«</h2>
                    <div id="qrcode" class="qr-placeholder"></div>
                    <p class="text-sm">QRã‚³ãƒ¼ãƒ‰ï¼ˆå…¥å ´æ™‚ã«æç¤ºï¼‰</p>
                    
                    <div class="ticket-info">
                        <div class="info-row">
                            <span class="info-label">äºˆç´„æ™‚é–“</span>
                            <span class="info-value time" id="ticketTime"></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">äººæ•°</span>
                            <span class="info-value" id="ticketGuests"></span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">äºˆç´„æ—¥</span>
                            <span class="info-value" id="ticketDate"></span>
                        </div>
                    </div>
                </div>

                <div class="warning-box">
                    <div class="warning-title">âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …</div>
                    <div class="warning-list">
                        â€¢ ã“ã®ç”»é¢ã‚’ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã§ä¿å­˜ã—ã¦ãã ã•ã„<br>
                        â€¢ äºˆç´„æ™‚é–“ã®5åˆ†å‰ã¾ã§ã«ãŠè¶Šã—ãã ã•ã„<br>
                        â€¢ å…¥å ´æ™‚ã«QRã‚³ãƒ¼ãƒ‰ã‚’æç¤ºã—ã¦ãã ã•ã„<br>
                        â€¢ é…ã‚ŒãŸå ´åˆã¯æ¬¡ã®æ™‚é–“å¸¯ã§ã®æ¡ˆå†…ã¨ãªã‚Šã¾ã™
                    </div>
                </div>

                <div style="margin-top: 24px;">
                    <button class="btn btn-secondary" onclick="cancelReservation()">
                        äºˆç´„ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                    </button>
                </div>
            </div>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—4: ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³å®Œäº† -->
        <div id="step4" class="hidden">
            <div class="header" style="background: linear-gradient(to right, #16a34a, #059669);">
                <div class="header-icon">ğŸ‰</div>
                <div style="display: inline-block;">
                    <h1>ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³å®Œäº†</h1>
                    <p>ã”æ¥å ´ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™</p>
                </div>
            </div>
            <div class="content" style="background: linear-gradient(to bottom, #dcfce7, #d1fae5);">
                <div class="check-in-success">
                    <div class="check-in-icon">âœ¨</div>
                    <div class="check-in-message">ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ãŒå®Œäº†ã—ã¾ã—ãŸ</div>
                    <div class="check-in-details">
                        <p>ã”æ¥å ´ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚</p>
                        <p>ã‚¹ã‚¿ãƒƒãƒ•ãŒã”æ¡ˆå†…ã„ãŸã—ã¾ã™ã®ã§ã€ãŠå¾…ã¡ãã ã•ã„ã€‚</p>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        var selectedTime = '';
        var guestCount = 1;
        var reservationData = null;

        var timeSlots = [
            { time: '10:00 - 10:30', available: 8, total: 15 },
            { time: '10:30 - 11:00', available: 12, total: 15 },
            { time: '11:00 - 11:30', available: 5, total: 15 },
            { time: '11:30 - 12:00', available: 0, total: 15 },
            { time: '12:00 - 12:30', available: 3, total: 15 },
            { time: '12:30 - 13:00', available: 0, total: 15 },
            { time: '13:00 - 13:30', available: 7, total: 15 },
            { time: '13:30 - 14:00', available: 10, total: 15 },
            { time: '14:00 - 14:30', available: 9, total: 15 },
            { time: '14:30 - 15:00', available: 15, total: 15 }
        ];

        document.addEventListener('DOMContentLoaded', function() {
            loadTimeSlots();
            checkExistingReservation();
            renderTimeSlots();
        });

        // æ—¢å­˜ã®äºˆç´„ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã€ã‚ã‚Œã°äºˆç´„å®Œäº†ç”»é¢ã«é·ç§»
        function checkExistingReservation() {
            var reservations = JSON.parse(localStorage.getItem('reservations') || '[]');
            var activeReservation = null;
            
            // æœ€æ–°ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªäºˆç´„ã‚’å–å¾—
            for (var i = reservations.length - 1; i >= 0; i--) {
                if (reservations[i].status === 'active') {
                    activeReservation = reservations[i];
                    break;
                }
            }
            
            if (activeReservation) {
                // äºˆç´„ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
                reservationData = {
                    time: activeReservation.time,
                    guests: activeReservation.guests,
                    qrCode: 'QR-' + activeReservation.time.replace(/[:\s-]/g, '') + '-' + activeReservation.guests,
                    date: activeReservation.date,
                    slotIndex: timeSlots.findIndex(slot => slot.time === activeReservation.time)
                };
                
                // ã¾ãšå…¨ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’éè¡¨ç¤ºã«ã™ã‚‹
                document.getElementById('step1').classList.add('hidden');
                document.getElementById('step2').classList.add('hidden');
                document.getElementById('step3').classList.add('hidden');
                document.getElementById('step4').classList.add('hidden');
                
                // äºˆç´„å®Œäº†ç”»é¢ã®å†…å®¹ã‚’è¨­å®š
                document.getElementById('ticketTime').textContent = reservationData.time;
                document.getElementById('ticketGuests').textContent = reservationData.guests + 'äºº';
                document.getElementById('ticketDate').textContent = reservationData.date;
                
                // QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã¾ã‚ŒãŸå¾Œã«å®Ÿè¡Œï¼‰
                setTimeout(function() {
                    var qrcodeElement = document.getElementById("qrcode");
                    qrcodeElement.innerHTML = '';
                    if (typeof QRCode !== 'undefined') {
                        new QRCode(qrcodeElement, {
                            text: reservationData.qrCode,
                            width: 128,
                            height: 128,
                            colorDark: "#000000",
                            colorLight: "#ffffff",
                            correctLevel: QRCode.CorrectLevel.H
                        });
                    }
                }, 100);
                
                // äºˆç´„å®Œäº†ç”»é¢ã®ã¿ã‚’è¡¨ç¤º
                document.getElementById('step3').classList.remove('hidden');
            }
        }

        // localStorageã‹ã‚‰æ™‚é–“å¸¯ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        function loadTimeSlots() {
            var savedSlots = localStorage.getItem('timeSlots');
            if (savedSlots) {
                timeSlots = JSON.parse(savedSlots);
            }
        }

        // localStorageã«æ™‚é–“å¸¯ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
        function saveTimeSlots() {
            localStorage.setItem('timeSlots', JSON.stringify(timeSlots));
        }

        function renderTimeSlots() {
            var container = document.getElementById('timeSlots');
            container.innerHTML = '';

            for (var i = 0; i < timeSlots.length; i++) {
                var slot = timeSlots[i];
                var isAvailable = slot.available >= guestCount;
                var isFull = slot.available === 0;
                
                var button = document.createElement('button');
                button.className = 'time-slot';
                button.disabled = !isAvailable;
                
                if (selectedTime === slot.time) {
                    button.classList.add('selected');
                }

                var statusClass = 'available';
                var dotClass = 'dot-green';
                var statusText = 'æ®‹ã‚Š' + slot.available + 'äºº';

                if (isFull) {
                    statusClass = 'full';
                    dotClass = 'dot-red';
                    statusText = 'æº€å“¡';
                } else if (slot.available <= 5) {
                    statusClass = 'warning';
                    dotClass = 'dot-yellow';
                }

                button.innerHTML = '<div class="time-info"><div class="time-text">' + slot.time + '</div><div class="availability ' + statusClass + '">' + statusText + '</div></div><div class="status-dot ' + dotClass + '"></div>';

                if (isAvailable) {
                    button.onclick = createSelectTimeFunction(slot.time);
                }

                container.appendChild(button);
            }
        }

        function createSelectTimeFunction(time) {
            return function() {
                selectTime(time);
            };
        }

        function selectTime(time) {
            selectedTime = time;
            renderTimeSlots();
            document.getElementById('nextBtn1').classList.remove('hidden');
        }

        function goToStep1() {
            document.getElementById('step1').classList.remove('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('step4').classList.add('hidden');
        }

        function goToStep2() {
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.remove('hidden');
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('step4').classList.add('hidden');
            document.getElementById('selectedTimeDisplay').textContent = 'é¸æŠæ™‚é–“: ' + selectedTime;
            updateRemainingSlots();
        }

        function goToStep3() {
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.remove('hidden');
            document.getElementById('step4').classList.add('hidden');
        }

        function changeGuestCount(delta) {
            var selectedSlot = null;
            for (var i = 0; i < timeSlots.length; i++) {
                if (timeSlots[i].time === selectedTime) {
                    selectedSlot = timeSlots[i];
                    break;
                }
            }
            
            var maxGuests = Math.min(5, selectedSlot.available);
            guestCount = Math.max(1, Math.min(maxGuests, guestCount + delta));
            document.getElementById('guestDisplay').textContent = guestCount;
            updateRemainingSlots();
        }

        function updateRemainingSlots() {
            var selectedSlot = null;
            for (var i = 0; i < timeSlots.length; i++) {
                if (timeSlots[i].time === selectedTime) {
                    selectedSlot = timeSlots[i];
                    break;
                }
            }
            document.getElementById('remainingSlots').textContent = 'ã“ã®æ™‚é–“å¸¯ã®æ®‹ã‚Šæ : ' + selectedSlot.available + 'äºº';
        }



        function makeReservation() {
            var selectedSlot = null;
            for (var i = 0; i < timeSlots.length; i++) {
                if (timeSlots[i].time === selectedTime) {
                    selectedSlot = timeSlots[i];
                    break;
                }
            }
            
            reservationData = {
                time: selectedTime,
                guests: guestCount,
                qrCode: 'QR-' + selectedTime.replace(/[:\s-]/g, '') + '-' + guestCount,
                date: new Date().toLocaleDateString('ja-JP'),
                slotIndex: timeSlots.findIndex(slot => slot.time === selectedTime)
            };

            selectedSlot.available -= guestCount;
            
            // äºˆç´„ãƒ‡ãƒ¼ã‚¿ã‚’localStorageã«ä¿å­˜
            var reservations = JSON.parse(localStorage.getItem('reservations') || '[]');
            reservations.push({
                time: reservationData.time,
                guests: reservationData.guests,
                date: reservationData.date,
                status: 'active'
            });
            localStorage.setItem('reservations', JSON.stringify(reservations));
            
            // æ™‚é–“å¸¯ãƒ‡ãƒ¼ã‚¿ã‚‚ä¿å­˜
            saveTimeSlots();

            document.getElementById('ticketTime').textContent = reservationData.time;
            document.getElementById('ticketGuests').textContent = reservationData.guests + 'äºº';
            document.getElementById('ticketDate').textContent = reservationData.date;

            // QRã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
            var qrcodeElement = document.getElementById("qrcode");
            qrcodeElement.innerHTML = ''; // æ—¢å­˜ã®QRã‚³ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªã‚¢
            new QRCode(qrcodeElement, {
                text: reservationData.qrCode,
                width: 128,
                height: 128,
                colorDark: "#000000",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });

            goToStep3();
        }

        // QRã‚³ãƒ¼ãƒ‰èª­ã¿å–ã‚Šæ©Ÿèƒ½ã®åˆæœŸåŒ–
        function initQRScanner() {
            const html5QrCode = new Html5Qrcode("qr-reader");
            const qrCodeSuccessCallback = (decodedText, decodedResult) => {
                if (decodedText.startsWith('QR-')) {
                    html5QrCode.stop().then(() => {
                        goToStep4();
                    });
                }
            };
            const config = { fps: 10, qrbox: { width: 250, height: 250 } };
            html5QrCode.start({ facingMode: "environment" }, config, qrCodeSuccessCallback);
        }

        function goToStep4() {
            document.getElementById('step1').classList.add('hidden');
            document.getElementById('step2').classList.add('hidden');
            document.getElementById('step3').classList.add('hidden');
            document.getElementById('step4').classList.remove('hidden');
        }

        function cancelReservation() {
            if (confirm('äºˆç´„ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚')) {
                if (reservationData && reservationData.slotIndex !== -1) {
                    // æ™‚é–“å¸¯ã®ç©ºãã‚’æˆ»ã™
                    timeSlots[reservationData.slotIndex].available += reservationData.guests;
                    saveTimeSlots();
                    
                    // äºˆç´„å±¥æ­´ã‚’æ›´æ–°ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã«å¤‰æ›´ï¼‰
                    var reservations = JSON.parse(localStorage.getItem('reservations') || '[]');
                    for (var i = reservations.length - 1; i >= 0; i--) {
                        if (reservations[i].time === reservationData.time && 
                            reservations[i].guests === reservationData.guests && 
                            reservations[i].status === 'active') {
                            reservations[i].status = 'cancelled';
                            break;
                        }
                    }
                    localStorage.setItem('reservations', JSON.stringify(reservations));
                }
                
                // ç”»é¢ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦æ–°ã—ã„äºˆç´„ã‚’å¯èƒ½ã«ã™ã‚‹
                selectedTime = '';
                guestCount = 1;
                reservationData = null;
                document.getElementById('guestDisplay').textContent = '1';
                document.getElementById('nextBtn1').classList.add('hidden');
                
                // å…¨ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’éè¡¨ç¤ºã«ã—ã¦ã‹ã‚‰ã‚¹ãƒ†ãƒƒãƒ—1ã®ã¿ã‚’è¡¨ç¤º
                document.getElementById('step1').classList.add('hidden');
                document.getElementById('step2').classList.add('hidden');
                document.getElementById('step3').classList.add('hidden');
                document.getElementById('step4').classList.add('hidden');
                
                document.getElementById('step1').classList.remove('hidden');
                renderTimeSlots();
                
                alert('äºˆç´„ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸã€‚æ–°ã—ã„äºˆç´„ãŒã§ãã¾ã™ã€‚');
            }
        }


    </script>
</body>
</html>